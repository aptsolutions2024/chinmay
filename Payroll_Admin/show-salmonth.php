<?php$doc_path = $_SERVER["DOCUMENT_ROOT"];include($doc_path . '/include_payroll_admin.php');$comp_id=$_SESSION['comp_id'];$user_id=$_SESSION['log_id'];$result1 = $payrollAdmin->showClient1($comp_id,$user_id);$result = $payrollAdmin->displayClientGroup();$_SESSION['month']='current';?><!DOCTYPE html><head>  <meta charset="utf-8"/>  <!-- Set the viewport width to device width for mobile -->  <meta name="viewport" content="width=device-width"/>  <title>Salary | Reports</title>      <script>    document.addEventListener('DOMContentLoaded', function() {        // Update the form with the previously selected values        document.getElementById('client').value = "<?php echo $client; ?>";        document.getElementById('clientGroup').value = "<?php echo $clientGroup; ?>";        document.querySelector(`input[name="month"][value="<?php echo $month; ?>"]`).checked = true;        document.getElementById('frdt').value = "<?php echo $frdt; ?>";        // Show or hide the From Date section based on the selected month        if ("<?php echo $month; ?>" === 'previous') {            document.getElementById('showPrevious').style.display = 'flex';        } else {            document.getElementById('showPrevious').style.display = 'none';        }    });</script><script>    function updateCurrentMonth() {    var select = document.getElementById('client'); // Change 'clientid' to 'client'    var selectedOption = select.options[select.selectedIndex];    var currentMonth = selectedOption.getAttribute('data-current-month');    document.getElementById('current-month').textContent = currentMonth || '--select--'; // Fallback to '--select--' if no month is found}function editsalMonth(id) {    console.log("Editing ID: ", id);       $.post('/edit-sal-month', { 'id': id }, function (data) {        $("#addclient").hide();        $("#editclient").html(data);        $("#editclient").show();        // Smooth scroll to the form        $('html, body').animate({            scrollTop: $("#editclient").offset().top // Scroll to the top of the form        }, 1000); // Duration in milliseconds    });}         function update(id) {    console.log("Update function called"); // Check if this log appears    $('#success1').hide(); // Hide success message initially    // Gather the form data    var client = $('#editclient').val();    var clientGroup = $('#editclientGroup').val();    var date = $('input[name="editdate"]').val();    var yes_no = $('input[name="edityes_no"]:checked').val();    console.log("id:", id);    console.log("client:", client);    console.log("clientGroup:", clientGroup);    console.log("date:", date);    console.log("yes_no:", yes_no);    // AJAX request to update the client group    $.ajax({        url: '/update-sal-month-process', // Ensure this path is correct        type: 'POST',        data: {            'id': id,            'client': client,            'clientGroup': clientGroup,            'date': date,            'yes_no': yes_no        },        success: function(response) {            console.log(response);            if (response.success) {                $("#error").hide();                $("#success1").html('Record updated successfully').show();                // Redirect after successful update                window.location.href = '/show-salmonth'; // Change to your desired URL            } else {                $("#error").html('Update failed: ' + response.message).show();            }            // Reload specific parts of the page if needed            $("#editclient").load(document.URL + ' #editclient');            $("#addclient").show();                        $("#dispaly").load(document.URL + ' #dispaly');        },        error: function(jqXHR, textStatus, errorThrown) {            console.error('Error:', textStatus, errorThrown);            $("#error").html('An error occurred. Please try again.').show();        }    });}            </script> <body><!--Header starts here--><?php include('header.php');?><!--Header end here--><div class="clearFix"></div><!--Menu starts here--><!--Menu ends here--><div class="clearFix"></div><!--Slider part starts here--><div class="twelve mobicenter innerbg">    <div class="row">        <div class="twelve" id="margin1"> <h3>Employee Salary Month</h3></div>        <div class="clearFix"></div>        <div class="twelve" id="margin1">                     <div class="boxborder">                 <!-- Form for Redirecting to /show-salmonth-process -->    <form action="/show-salmonth-process" method="post" id="editclient">                <!-- Client: and Month: row -->        <div class="row">            <!-- Month: Current/Previous Row -->            <div style="display: flex; align-items: center;">                <div class="six columns">                    <!-- From Date Row (Initially hidden) -->                    <div id="showPrevious" class="hidecontent" style="display: none; flex: 1; align-items: center;">                        <div class="two columns">                            <span class="labelclass1">From:</span>                        </div>                        <div class="four columns">                            <input type="month" name="frdt" id="frdt" class="textclass">                            <span class="errorclass hidecontent" id="fderror"></span>                        </div>                    </div>                </div>            </div>        </div>                <!-- Client Dropdown -->        <div class="row">            <div class="two columns">                <span class="labelclass1">Client:</span>            </div>            <div class="three columns">                <select class="textclass" name="client" id="client" onchange="updateCurrentMonth(); $('#linkshow').hide(); resetClientGroup();" style="width: 100%;">                    <option value="">--Select--</option>                    <?php foreach($result1 as $row1) { ?>                        <option value="<?php echo $row1['mast_client_id']; ?>" data-current-month="<?php echo date('F Y', strtotime($row1['current_month'])); ?>">                            <?php echo $row1['client_name']; ?> - <?php echo date('F Y', strtotime($row1['current_month'])); ?>                        </option>                    <?php } ?>                </select>                <span class="errorclass hidecontent" id="nerror" style="display: block; margin-top: 5px;"></span>            </div>                        <!-- Month Display -->            <div class="three columns" style="text-align: left;">                <span style="color:#7d1a15; margin-left: 10px;">                    Month: <span id="current-month"></span>                </span>            </div>        </div>                        <!-- CLient Group -->         <div class="row">        <div class="two columns">            <span class="labelclass1">Client Group:</span>        </div>        <div class="three columns">            <select class="textclass" name="clientGroup" id="clientGroup"  onchange="$('#linkshow').hide(); resetClient()">                <option value="">--Select--</option>                <?php foreach($result as $row2) { ?>                <option value="<?php echo $row2['id']; ?>">                    <?php echo $row2['group_name']; ?>                </option>                <?php } ?>            </select>        </div>    </div>                <!-- Date Input -->        <div class="row" style="margin-top: 10px;">            <div class="two columns">                <span class="labelclass1">Date:</span>            </div>            <div class="three columns">                <input type="month" name="date" class="textclass" required>            </div>        </div>                <!-- Yes/No Radio Button -->        <div class="row" style="margin-top: 10px;">            <div class="two columns">                <span class="labelclass1">Show to employee:</span>            </div>            <div class="four columns" style="display: flex; gap: 10px;">                <label>                    <input type="radio" name="yes_no" value="Yes" required> Yes                </label>                <label>                    <input type="radio" name="yes_no" value="No"> No                </label>            </div>        </div>        <div class="two columns"></div>        <!-- Submit Button -->        <div class="row" style="margin-top: 20px;">            <div class="two columns">                <button type="submit" class="submitbtn">Submit</button>            </div>            <div class="two columns">                <button type="reset" class="submitbtn">Clear </button>            </div>        </div>            </form>    </div> <!--<div id="editclient"></div>-->        <div class="twelve" id="margin1">    <h3>Display Client</h3></div><hr><span class="successclass hidecontent" id="success1"></span><div class="twelve" id="margin1" style="background-color: #fff;">    <div id="dispaly">        <table width="100%" id="example" class="display">    <thead>        <tr>            <th align="left" width="5%">Sr.No</th>            <th align="left" width="20%">Client Name</th>            <th align="left" width="20%">Group Name</th>            <th align="left" width="20%">Date</th>            <th align="left" width="20%">Show To Employee</th>            <th align="center" width="10%">Action</th>        </tr>    </thead>    <tbody>        <?php        $limit = 10; // Number of records per page        $page = isset($_GET['page']) ? (int)$_GET['page'] : 1; // Get the current page number        $offset = ($page - 1) * $limit; // Calculate the offset        // Fetch all client groups        $result = $payrollAdmin->displaySalmonth();         $totalRecords = count($result); // Get total records        $totalPages = ceil($totalRecords / $limit); // Calculate total pages        // Slice the result array to get only the records for the current page        $result = array_slice($result, $offset, $limit);        $count = $offset + 1; // Initialize count based on offset        foreach ($result as $row) {            ?>            <tr id="row_<?= $row['id']; ?>">                <td class="tdata"><?php echo $count; ?></td>                <td class="tdata"><?= $row['client_id'] == 0 ? 'NULL' : htmlspecialchars($row['client_name']); ?></td>                <td class="tdata"><?= $row['group_name'] == '' ? 'NULL' : htmlspecialchars($row['group_name']); ?></td>                <td class="tdata"><?= htmlspecialchars(date('M Y',strtotime($row['sal_month']))); ?></td>                <td class="tdata"><?= htmlspecialchars($row['flag']); ?></td>                <td class="tdata" align="center">                    <a onclick="editsalMonth('<?=$row['id'];?>');" class="icon-spacing">                        <img src="Payroll/images/edit-icon.png" />                    </a>                </td>            </tr>            <?php            $count++;        }        if (count($result) == 0) {            ?>            <tr align="center">                <td colspan="6" class="tdata errorclass">                    <span class="norec">No record found</span>                </td>            </tr>        <?php } ?>    </tbody></table></div>    <!-- Pagination Links -->    <div class="pagination">        <?php if ($page > 1): ?>            <a href="?page=<?= $page - 1; ?>">Previous</a>        <?php endif; ?>        <?php for ($i = 1; $i <= $totalPages; $i++): ?>            <a href="?page=<?= $i; ?>" class="<?= ($i == $page) ? 'active' : ''; ?>"><?= $i; ?></a>        <?php endfor; ?>        <?php if ($page < $totalPages): ?>            <a href="?page=<?= $page + 1; ?>">Next</a>        <?php endif; ?>    </div></div><style>.pagination {    text-align: center;    margin-top: 20px;}.pagination a {    margin: 0 5px;    padding: 8px 12px;    text-decoration: none;    border: 1px solid #ccc;    border-radius: 5px;}.pagination a.active {    background-color: #007bff;    color: white;}.pagination a:hover:not(.active) {    background-color: #f1f1f1;}</style> </div>    </div>    </div></div></div><!--Slider part ends here--><div class="clearFix"></div><!--footer start --><?php include('footer.php');?><link rel="stylesheet" href="Payroll/css/jquery-ui.css"><script type="text/javascript" src="Payroll/js/jquery.min.js"></script>    <script type="text/javascript" src="Payroll/js/jquery-ui.js"></script><script>      function resetClient(){          $('#client').val('');      }      function resetClientGroup(){          $('#clientGroup').val('');      }    //  function saveclint(){    //         $('#derror').html('');    //         $('#nerror').html('');    //         var val= document.getElementById('client').value;    //         var cgrp= document.getElementById('clientGroup').value;    //         if (val>0 && cgrp>0)    //           {    //               alert ("Please select either Client or Client Group at a time !!");    //               $('#linkshow').hide();               //               return;    //           }    //         var  clientGrp= document.getElementById('clientGroup').value;    //         var frdt=0;    //         var Count=0;    //         var months = document.getElementsByName('month');    //         var month_value;    //         for(var i = 0; i < months.length; i++){    //             if(months[i].checked){    //                 month_value = months[i].value;    //             }    //         }    //         if(month_value=='current'){    //             $('#showPrevious').hide();    //         }    //         if(val=='' && cgrp== ''){    //             Count=0;    //             $('#nerror').html("Please select the Client or Client Group");    //             $('#nerror').show();    //             document.getElementById("client").focus();    //             $('#linkshow').hide();    //         }    //         else if(month_value=='previous'){    //             frdt = document.getElementById('frdt').value;    //             if(frdt==''){    //                 $('#fderror').html("Please enter date");    //                 $('#fderror').show();    //                 $('#tderror').hide();    //                 $('#linkshow').hide();    //             }    //             else{    //             Count=1;    //             }    //         }else{    //             Count=1;    //         }    //         if(Count!=0){    //             $('#nerror').html('');    //             $('#nerror').hide();    //             $.post('/store_session', {    //                 'clientid': val,    //                 'frdt':frdt,    //                 'clientGrp':cgrp,    //                 // 'todt':todt,    //                 'month_value': month_value    //             }, function (data) {    //                 $('#linkshow').show();    //             });    //             diplayform(1);    //         }    //     }                    //     function saveclint1(){    //         var val= document.getElementById('client').value;    //         var Count=0;    //         var months = document.getElementsByName('month');    //         var month_value;    //         for(var i = 0; i < months.length; i++){    //             if(months[i].checked){    //                 month_value = months[i].value;    //             }    //         }    //         if(val==''){    //             Count=0;    //             $('#nerror').html("Please select the Client");    //             $('#nerror').show();    //             document.getElementById("client").focus();    //             $('#linkshow').hide();    //         }    //         else if(month_value=='previous'){    //             $('#showPrevious').show();    //             var frdt = document.getElementById('frdt').value;    //             //var todt = document.getElementById('todt').value;				// var todt = document.getElementById('frdt').value;    //     // Alert boxes to check the dates    //     alert("From Date: " + frdt);    //     alert("To Date: " + todt);    //             if(frdt==''){    //                 $('#fderror').html("Please enter date");    //                 $('#fderror').show();    //                 $('#tderror').hide();    //                 $('#linkshow').hide();    //             }    //             else if(todt==''){    //                 $('#tderror').html("Please enter date");    //                 $('#tderror').show();    //                 $('#fderror').hide();    //                 $('#linkshow').hide();    //             }    //             else{    //                 Count=1;    //             }    //         }else{    //             Count=1;    //         }    //         if(Count!=0){    //             $('#nerror').html('');    //             $('#nerror').hide();    //             $.get('/store_session', {    //                 'clientid': val,    //                 'frdt':frdt,    //                 'todt':todt,    //                 'month_value': month_value    //             }, function (data) {    //                 $('#linkshow').show();    //                 $('#fderror').html('');    //                 $('#tderror').html('');    //                 $('#nerror').html('');    //             });    //             diplayform(1);    //         }    //     }//  function diplayform(val){//      if(val=='1'){//          $.post('/report-payslip', {//          }, function (data) {//              $('#dispfrm').html(data);//              $('.btntableft').removeClass('activeBtn');//              $('.btntableft').addClass('tabbutton');//              $('#'+val).addClass('activeBtn');//              $('#'+val).removeClass('tabbutton');//          });//      }//      else if(val=='2'){//          $.post('/report-paysheet-printing', {//          }, function (data) {//              $('.btntableft').removeClass('activeBtn');//              $('.btntableft').addClass('tabbutton');//              $('#dispfrm').html(data);//              $('#'+val).addClass('activeBtn');//              $('#'+val).removeClass('tabbutton');//          });//      }	 //      else if(val=='3'){//          $.post('/report-sal-summary', {//          }, function (data) {//              $('.btntableft').removeClass('activeBtn');//              $('.btntableft').addClass('tabbutton');//              $('#dispfrm').html(data);//              $('#'+val).addClass('activeBtn');//              $('#'+val).removeClass('tabbutton');//          });//      } else if(val=='4') {//          $.post('/report-email-payslip', {}, function (data) {//              $('.btntableft').removeClass('activeBtn');//              $('.btntableft').addClass('tabbutton');//              $('#dispfrm').html(data);//              $('#' + val).addClass('activeBtn');//              $('#' + val).removeClass('tabbutton');//          });//      }//      else  if(val=='5'){//          $.post('/report-export-payslip', {//          }, function (data) {//              $('#dispfrm').html(data);//              $('.btntableft').removeClass('activeBtn');//              $('.btntableft').addClass('tabbutton');//              $('#'+val).addClass('activeBtn');//              $('#'+val).removeClass('tabbutton');//          });//      }//      else if(val=='6'){//          $.post('/report-dpaysheet', {//          }, function (data) {//              $('.btntableft').removeClass('activeBtn');//              $('.btntableft').addClass('tabbutton');//              $('#dispfrm').html(data);//              $('#'+val).addClass('activeBtn');//              $('#'+val).removeClass('tabbutton');//          });//      }// 	  else if(val=='7'){//          $.post('/report-wpaysheet', {//          }, function (data) {//              $('.btntableft').removeClass('activeBtn');//              $('.btntableft').addClass('tabbutton');//              $('#dispfrm').html(data);//              $('#'+val).addClass('activeBtn');//              $('#'+val).removeClass('tabbutton');//          });//      }// 	  else if(val=='8'){//          $.post('/bank-excel', {//          }, function (data) {//              $('.btntableft').removeClass('activeBtn');//              $('.btntableft').addClass('tabbutton');//              $('#dispfrm').html(data);//              $('#'+val).addClass('activeBtn');//              $('#'+val).removeClass('tabbutton');//          });//      }//  }    </script><!--footer end --></body></html>